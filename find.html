<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Find My Film — Sunsong Cinema</title>
<meta name="description" content="Describe your mood and we find two films made just for you.">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;1,300;1,400;1,600&family=Cinzel:wght@400;600;700&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{
  --black:#080705;--warm:#0e0c09;--gold:#c8a44a;--gl:#e5d098;
  --gd:rgba(200,164,74,0.1);--cream:#f2ebe0;--dim:#635a4f;
  --text:#e0d8cc;--border:rgba(200,164,74,0.12);
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  background:var(--black);color:var(--text);
  font-family:"DM Sans",sans-serif;font-weight:300;
  min-height:100vh;overflow-x:hidden;
}
/* grain */
body::before{
  content:'';position:fixed;inset:0;
  background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none;z-index:9999;opacity:0.3;mix-blend-mode:overlay;
}

/* HEADER */
header{
  position:fixed;top:0;left:0;right:0;z-index:100;
  padding:20px 48px;display:flex;justify-content:space-between;align-items:center;
  background:linear-gradient(to bottom,rgba(8,7,5,0.97) 0%,transparent 100%);
  border-bottom:1px solid var(--border);
}
.logo{font-family:"Cinzel",serif;font-size:17px;font-weight:600;letter-spacing:0.2em;color:var(--gold);text-decoration:none}
.logo span{color:var(--cream);font-weight:400}
.back-link{font-size:11px;letter-spacing:0.14em;text-transform:uppercase;color:var(--dim);text-decoration:none;display:flex;align-items:center;gap:8px;transition:color 0.2s}
.back-link:hover{color:var(--gold)}

/* PAGE LAYOUT */
.page{
  min-height:100vh;
  display:grid;
  grid-template-columns:1fr 1fr;
}

/* LEFT — INPUT PANEL */
.panel-left{
  padding:120px 64px 80px;
  display:flex;flex-direction:column;justify-content:center;
  position:relative;
  border-right:1px solid var(--border);
  min-height:100vh;
}
.panel-left::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse at 0% 60%,rgba(200,130,20,0.08) 0%,transparent 60%);
  pointer-events:none;
}
.panel-eyebrow{
  font-size:10px;letter-spacing:0.32em;text-transform:uppercase;
  color:var(--gold);margin-bottom:24px;
  display:flex;align-items:center;gap:12px;
}
.panel-eyebrow::after{content:'';flex:1;height:1px;background:var(--gold);opacity:0.25;max-width:60px}
.panel-title{
  font-family:"Cormorant Garamond",serif;
  font-size:clamp(36px,4.5vw,60px);
  font-weight:300;line-height:1.05;
  color:var(--cream);margin-bottom:12px;
}
.panel-title em{font-style:italic;color:var(--gl)}
.panel-sub{
  font-family:"Cormorant Garamond",serif;
  font-size:clamp(15px,1.4vw,18px);
  font-style:italic;color:var(--dim);
  line-height:1.7;margin-bottom:48px;max-width:440px;
}

/* THE INPUT */
.finder-form{position:relative;z-index:2}
.finder-textarea-wrap{
  background:rgba(255,255,255,0.02);
  border:1px solid rgba(200,164,74,0.2);
  padding:24px;margin-bottom:6px;
  transition:border-color 0.3s;
  position:relative;
}
.finder-textarea-wrap:focus-within{border-color:rgba(200,164,74,0.5)}
.finder-textarea{
  width:100%;min-height:140px;
  background:transparent;border:none;outline:none;
  color:var(--cream);
  font-family:"Cormorant Garamond",serif;
  font-size:20px;font-weight:300;
  line-height:1.6;resize:none;
}
.finder-textarea::placeholder{color:rgba(99,90,79,0.45);font-style:italic}
.finder-char-count{
  font-size:10px;letter-spacing:0.1em;color:var(--dim);
  text-align:right;margin-bottom:20px;
}

/* EXAMPLE CHIPS */
.finder-examples{margin-bottom:28px}
.finder-examples-label{
  font-size:9px;letter-spacing:0.22em;text-transform:uppercase;
  color:rgba(200,164,74,0.35);margin-bottom:10px;
}
.finder-chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{
  background:none;border:1px solid rgba(200,164,74,0.15);
  color:var(--dim);padding:7px 14px;
  font-size:12px;letter-spacing:0.06em;
  cursor:pointer;font-family:"DM Sans",sans-serif;
  transition:all 0.2s;
}
.chip:hover{border-color:rgba(200,164,74,0.4);color:var(--text);background:var(--gd)}

/* SUBMIT */
.finder-submit{
  width:100%;background:var(--gold);color:var(--black);
  border:none;padding:18px 32px;
  font-family:"DM Sans",sans-serif;font-size:12px;
  letter-spacing:0.18em;text-transform:uppercase;
  cursor:pointer;display:flex;align-items:center;justify-content:center;gap:12px;
  transition:all 0.25s;
}
.finder-submit:hover:not(:disabled){background:var(--gl);transform:translateY(-1px)}
.finder-submit:disabled{opacity:0.5;cursor:not-allowed;transform:none}
.finder-submit .submit-icon{font-size:16px;transition:transform 0.3s}
.finder-submit:not(:disabled):hover .submit-icon{transform:rotate(15deg)}

/* RIGHT — RESULTS PANEL */
.panel-right{
  padding:120px 64px 80px;
  display:flex;flex-direction:column;justify-content:center;
  position:relative;min-height:100vh;
}
.panel-right::before{
  content:'';position:absolute;inset:0;
  background:radial-gradient(ellipse at 100% 40%,rgba(200,164,74,0.05) 0%,transparent 55%);
  pointer-events:none;
}

/* IDLE STATE */
.results-idle{
  display:flex;flex-direction:column;align-items:center;
  justify-content:center;text-align:center;
  opacity:1;transition:opacity 0.4s;
  padding:40px 0;
}
.idle-sun{
  font-size:64px;margin-bottom:28px;
  animation:idlePulse 4s ease-in-out infinite;
  filter:drop-shadow(0 0 20px rgba(200,164,74,0.3));
}
@keyframes idlePulse{
  0%,100%{filter:drop-shadow(0 0 16px rgba(200,164,74,0.25));transform:scale(1)}
  50%{filter:drop-shadow(0 0 36px rgba(200,164,74,0.6));transform:scale(1.04)}
}
.idle-title{
  font-family:"Cormorant Garamond",serif;
  font-size:28px;font-weight:300;font-style:italic;
  color:rgba(224,216,204,0.4);line-height:1.4;
  max-width:320px;
}

/* LOADING STATE */
.results-loading{
  display:none;flex-direction:column;align-items:center;
  justify-content:center;text-align:center;padding:40px 0;
}
.loading-sun{
  font-size:56px;margin-bottom:28px;
  animation:loadingSpin 2s linear infinite;
}
@keyframes loadingSpin{
  0%{transform:rotate(0deg) scale(1);filter:drop-shadow(0 0 10px rgba(200,164,74,0.4))}
  50%{transform:rotate(180deg) scale(1.1);filter:drop-shadow(0 0 28px rgba(200,164,74,0.8))}
  100%{transform:rotate(360deg) scale(1);filter:drop-shadow(0 0 10px rgba(200,164,74,0.4))}
}
.loading-text{
  font-family:"Cormorant Garamond",serif;
  font-size:20px;font-style:italic;color:var(--dim);
}
.loading-dots::after{
  content:'';animation:dots 1.5s steps(4,end) infinite;
}
@keyframes dots{
  0%{content:''}25%{content:'.'}50%{content:'..'}75%{content:'...'}100%{content:''}
}

/* RESULTS STATE */
.results-films{
  display:none;flex-direction:column;gap:0;
  opacity:0;transition:opacity 0.6s;
}
.results-films.visible{opacity:1}
.results-header{
  margin-bottom:32px;
}
.results-label{
  font-size:9px;letter-spacing:0.28em;text-transform:uppercase;
  color:rgba(200,164,74,0.4);margin-bottom:8px;
}
.results-query{
  font-family:"Cormorant Garamond",serif;
  font-size:18px;font-style:italic;color:var(--dim);
  line-height:1.5;
}

/* FILM RESULT CARD */
.result-card{
  border-top:1px solid var(--border);
  padding:28px 0;display:flex;gap:24px;
  transition:all 0.25s;cursor:pointer;
}
.result-card:last-child{border-bottom:1px solid var(--border)}
.result-card:hover{padding-left:8px}
.result-num{
  font-family:"Cinzel",serif;font-size:11px;
  color:rgba(200,164,74,0.3);letter-spacing:0.2em;
  padding-top:4px;flex-shrink:0;width:24px;
}
.result-poster{
  width:70px;flex-shrink:0;
  aspect-ratio:2/3;
  position:relative;overflow:hidden;
  border:1px solid var(--border);
  display:flex;align-items:center;justify-content:center;
  transition:border-color 0.25s;
}
.result-card:hover .result-poster{border-color:rgba(200,164,74,0.4)}
.result-poster-bg{position:absolute;inset:0;opacity:0.8}
.result-poster-sym{
  font-family:"Cormorant Garamond",serif;
  font-size:22px;opacity:0.12;color:var(--cream);
  position:relative;z-index:1;
}
.result-info{flex:1}
.result-meta{
  font-size:10px;letter-spacing:0.14em;text-transform:uppercase;
  color:var(--dim);margin-bottom:6px;
}
.result-title{
  font-family:"Cormorant Garamond",serif;
  font-size:26px;font-weight:400;color:var(--cream);
  line-height:1.1;margin-bottom:4px;
  transition:color 0.2s;
}
.result-card:hover .result-title{color:var(--gl)}
.result-director{
  font-family:"Cormorant Garamond",serif;
  font-size:14px;font-style:italic;color:var(--gold);
  margin-bottom:12px;
}
.result-why{
  font-family:"Cormorant Garamond",serif;
  font-size:15px;color:rgba(224,216,204,0.6);
  line-height:1.65;margin-bottom:14px;
}
.result-links{display:flex;gap:8px;flex-wrap:wrap}
.result-link{
  display:inline-flex;align-items:center;gap:6px;
  padding:7px 14px;font-size:10px;
  letter-spacing:0.12em;text-transform:uppercase;
  text-decoration:none;border:1px solid var(--border);
  color:var(--dim);transition:all 0.2s;
  font-family:"DM Sans",sans-serif;
}
.result-link:hover{border-color:var(--gold);color:var(--gold)}
.result-link-primary{
  background:var(--gold);color:var(--black)!important;
  border-color:var(--gold)!important;font-weight:500;
}
.result-link-primary:hover{background:var(--gl)!important}

/* TRY AGAIN */
.results-again{
  display:none;margin-top:28px;
}
.btn-again{
  background:none;border:1px solid var(--border);
  color:var(--dim);padding:12px 28px;
  font-family:"DM Sans",sans-serif;font-size:11px;
  letter-spacing:0.14em;text-transform:uppercase;
  cursor:pointer;transition:all 0.2s;width:100%;
}
.btn-again:hover{border-color:var(--gold);color:var(--gold)}

/* ERROR STATE */
.results-error{
  display:none;text-align:center;padding:40px 0;
}
.error-icon{font-size:40px;margin-bottom:16px;opacity:0.4}
.error-text{
  font-family:"Cormorant Garamond",serif;
  font-size:18px;font-style:italic;color:var(--dim);
}

/* RESPONSIVE */
@media(max-width:900px){
  header{padding:18px 24px}
  .page{grid-template-columns:1fr;grid-template-rows:auto auto}
  .panel-left{padding:100px 28px 48px;min-height:auto;border-right:none;border-bottom:1px solid var(--border)}
  .panel-right{padding:48px 28px 80px;min-height:auto}
}
</style>
</head>
<body>

<header>
  <a href="index.html" class="logo">Sunsong <span>Cinema</span></a>
  <a href="index.html" class="back-link">← Back to collections</a>
  <a href="platforms.html" class="back-link" style="margin-left:16px">All platforms →</a>
</header>

<main class="page">

  <!-- LEFT: INPUT -->
  <div class="panel-left">
    <div class="panel-eyebrow">Film Finder</div>
    <h1 class="panel-title">What kind of film<br>do you want to <em>see?</em></h1>
    <p class="panel-sub">Describe your mood, a theme, a country, a feeling, an actor or actress, a director, or an emotion, and we will propose two films made just for you. Human-made films for human-made humans, while supplies last.</p>

    <div class="finder-form">
      <div class="finder-textarea-wrap">
        <textarea
          class="finder-textarea"
          id="finderInput"
          placeholder="I feel like something slow and melancholic, set in Asia, about loneliness and time passing..."
          maxlength="400"
          rows="6"
          oninput="updateCount()"
        ></textarea>
      </div>
      <div class="finder-char-count"><span id="charCount">0</span> / 400</div>

      <div class="finder-examples">
        <div class="finder-examples-label">Try one of these</div>
        <div class="finder-chips">
          <button class="chip" onclick="setChip(this)">something funny and absurd</button>
          <button class="chip" onclick="setChip(this)">a political film that still gives hope</button>
          <button class="chip" onclick="setChip(this)">about grief, but not depressing</button>
          <button class="chip" onclick="setChip(this)">Italian neorealism</button>
          <button class="chip" onclick="setChip(this)">Korean cinema</button>
          <button class="chip" onclick="setChip(this)">I want to fall in love with cinema again</button>
          <button class="chip" onclick="setChip(this)">something to watch with my mother</button>
          <button class="chip" onclick="setChip(this)">directed by a woman</button>
        </div>
      </div>

      <button class="finder-submit" id="submitBtn" onclick="findFilms()">
        <span class="submit-icon">☀</span>
        <span>Find my two films</span>
      </button>
    </div>
  </div>

  <!-- RIGHT: RESULTS -->
  <div class="panel-right">

    <!-- IDLE -->
    <div class="results-idle" id="stateIdle">
      <div class="idle-sun">☀</div>
      <div class="idle-title">Your two films are waiting — describe what you feel.</div>
    </div>

    <!-- LOADING -->
    <div class="results-loading" id="stateLoading">
      <div class="loading-sun">☀</div>
      <div class="loading-text">Searching the universe of cinema<span class="loading-dots"></span></div>
    </div>

    <!-- RESULTS -->
    <div class="results-films" id="stateResults">
      <div class="results-header">
        <div class="results-label">Two films for you</div>
        <div class="results-query" id="resultsQuery"></div>
      </div>
      <div id="filmsContainer"></div>
      <div class="results-again" id="resultsAgain">
        <button class="btn-again" onclick="resetFinder()">↺ Find different films</button>
      </div>
    </div>

    <!-- ERROR -->
    <div class="results-error" id="stateError">
      <div class="error-icon">☁</div>
      <div class="error-text" id="errorText">Something went wrong. Please try again.</div>
    </div>

  </div>
</main>

<script>
function updateCount(){
  const v = document.getElementById('finderInput').value.length;
  document.getElementById('charCount').textContent = v;
}

function setChip(el){
  const input = document.getElementById('finderInput');
  input.value = el.textContent;
  updateCount();
  input.focus();
}

function setState(name){
  ['Idle','Loading','Results','Error'].forEach(s => {
    const el = document.getElementById('state'+s);
    if(s === 'Results'){
      el.style.display = name === s ? 'flex' : 'none';
      setTimeout(() => { if(name===s) el.classList.add('visible'); }, 50);
      if(name!==s) el.classList.remove('visible');
    } else {
      el.style.display = name === s ? 'flex' : 'none';
    }
  });
}

// Gradient + symbol library for unknown films
const GRADIENTS = [
  {bg:'linear-gradient(160deg,#0a1520,#1a3040)', sym:'映'},
  {bg:'linear-gradient(160deg,#1a1208,#3d2b0a)', sym:'光'},
  {bg:'linear-gradient(160deg,#0d1a0d,#122a12)', sym:'影'},
  {bg:'linear-gradient(160deg,#1a0d0d,#2a1215)', sym:'愛'},
  {bg:'linear-gradient(160deg,#150d1a,#20122a)', sym:'魂'},
  {bg:'linear-gradient(160deg,#0f0f12,#1a1a20)', sym:'夢'},
  {bg:'linear-gradient(160deg,#1a0a1a,#2a102a)', sym:'時'},
  {bg:'linear-gradient(160deg,#0a150a,#153015)', sym:'道'},
];

function getStyle(index){ return GRADIENTS[index % GRADIENTS.length]; }

function buildFilmCard(film, index){
  const style = getStyle(index);
  const mubiSearch = `https://mubi.com/search?q=${encodeURIComponent(film.title)}`;
  const jwSearch = `https://www.justwatch.com/us/search?q=${encodeURIComponent(film.title)}`;
  const amazonSearch = `https://www.amazon.com/s?k=${encodeURIComponent(film.title+' '+film.year+' film')}`;

  return `
    <div class="result-card">
      <div class="result-num">0${index+1}</div>
      <div class="result-poster">
        <div class="result-poster-bg" style="background:${style.bg}"></div>
        <div class="result-poster-sym">${style.sym}</div>
      </div>
      <div class="result-info">
        <div class="result-meta">${film.country || ''} · ${film.year || ''} · ${film.director || ''}</div>
        <div class="result-title">${film.title}</div>
        <div class="result-director">${film.director || ''}</div>
        <div class="result-why">${film.why}</div>
        <div class="result-links">
          <a class="result-link result-link-primary" href="${mubiSearch}" target="_blank" rel="noopener">▶ Watch on MUBI</a>
          <a class="result-link" href="${jwSearch}" target="_blank" rel="noopener">All platforms</a>
          <a class="result-link" href="${amazonSearch}" target="_blank" rel="noopener">Rent / Buy</a>
        </div>
      </div>
    </div>`;
}

async function findFilms(){
  const query = document.getElementById('finderInput').value.trim();
  if(!query) return;

  const btn = document.getElementById('submitBtn');
  btn.disabled = true;
  setState('Loading');

  const prompt = `You are the film curator for Sunsong Cinema — an elegant, human-curated world cinema platform. Your taste is refined, international, and deeply human.

A visitor has described what they are looking for: "${query}"

Respond with EXACTLY two film recommendations in this JSON format (no other text, no markdown, no backticks):
{
  "films": [
    {
      "title": "Film Title",
      "year": 1999,
      "director": "Director Name",
      "country": "Country",
      "duration": "120 min",
      "why": "Two or three sentences explaining why THIS film perfectly matches what they described. Write with warmth, intelligence and passion. Never start with 'This film'."
    },
    {
      "title": "Film Title",
      "year": 2010,
      "director": "Director Name",
      "country": "Country",
      "duration": "95 min",
      "why": "Two or three sentences explaining why THIS film perfectly matches what they described. Write with warmth, intelligence and passion. Never start with 'This film'."
    }
  ]
}

Rules:
- Choose films that are genuinely extraordinary and worth seeking out
- Prefer world cinema, international films, acclaimed independent films
- Vary between classics and contemporary films
- The "why" must feel personal and specific to their request, not generic
- Only real films that actually exist`;

  try {
    const response = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        messages: [{ role: "user", content: prompt }]
      })
    });

    const data = await response.json();

    if(!response.ok){
      throw new Error(data.error?.message || 'API error');
    }

    const text = data.content?.[0]?.text || '';
    const clean = text.replace(/```json|```/g,'').trim();
    const parsed = JSON.parse(clean);
    const films = parsed.films;

    if(!films || films.length < 2) throw new Error('No films returned');

    // Build result cards
    const container = document.getElementById('filmsContainer');
    container.innerHTML = films.map((f,i) => buildFilmCard(f,i)).join('');

    // Set query echo
    document.getElementById('resultsQuery').textContent = `"${query}"`;
    document.getElementById('resultsAgain').style.display = 'block';

    setState('Results');

  } catch(err) {
    console.error(err);
    document.getElementById('errorText').textContent =
      err.message?.includes('API') ? 'The cinema is momentarily closed. Please try again.' :
      'Something went wrong. Please try again.';
    setState('Error');
    setTimeout(() => setState('Idle'), 3000);
  } finally {
    btn.disabled = false;
  }
}

function resetFinder(){
  document.getElementById('finderInput').value = '';
  updateCount();
  setState('Idle');
  document.getElementById('resultsAgain').style.display = 'none';
}

// Enter key submits
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('finderInput').addEventListener('keydown', e => {
    if(e.key === 'Enter' && (e.ctrlKey || e.metaKey)) findFilms();
  });
});
</script>
</body>
</html>
